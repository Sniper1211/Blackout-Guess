## 修复生产环境日历加载慢与题目获取异常问题

### 问题分析
根据你的描述，生产环境中存在两个主要问题：
1. **日历加载非常慢** - 可能由于网络请求超时或阻塞
2. **控制台提示"获取 2026-01 题目异常"** - Supabase查询失败

### 根本原因
通过代码分析，我发现了几个关键问题：

#### 1. **Supabase查询条件过于严格**
- [app.js](file:///Users/lxx/coding/Blackout-Guess/js/app.js#L346-L353)：查询条件包含`.eq('language', 'zh-CN')`和`.eq('enabled', true)`
- 如果数据库中的题目没有设置`language`字段或`enabled`字段，查询会返回空结果
- 生产环境中可能缺少这些字段的默认值

#### 2. **网络请求阻塞**
- [UIManager.js](file:///Users/lxx/coding/Blackout-Guess/js/UIManager.js#L714-L718)：同时加载3个月的题目数据
- 如果某个月份查询失败，整个`Promise.all`会失败
- 没有超时机制，可能导致长时间等待

#### 3. **错误处理不完善**
- [app.js](file:///Users/lxx/coding/Blackout-Guess/js/app.js#L386)：只显示警告，没有具体错误信息
- 生产环境中由于安全修复，错误详情被清理，难以诊断问题

#### 4. **Supabase CDN加载问题**
- 生产环境中可能由于网络原因，Supabase JS库加载缓慢或失败

### 修复方案

#### 1. **优化Supabase查询条件**
- 移除或放宽`language`和`enabled`字段的强制要求
- 添加更宽松的查询条件，确保能获取到题目数据
- 添加字段存在性检查，避免因字段缺失导致查询失败

#### 2. **改进网络请求机制**
- 为月份查询添加超时机制（如5秒超时）
- 使用`Promise.allSettled`替代`Promise.all`，确保部分失败不影响整体
- 添加请求重试机制，提高网络不稳定性下的成功率

#### 3. **增强错误处理与诊断**
- 在生产环境中保留关键错误信息（安全清理后）
- 添加更详细的错误分类和诊断信息
- 实现优雅降级：当在线题库失败时，使用内置题库

#### 4. **优化加载策略**
- 实现懒加载：只加载当前可见月份的题目
- 添加缓存机制：减少重复网络请求
- 优化UI反馈：显示加载进度和状态

#### 5. **Supabase CDN优化**
- 检查Supabase库是否成功加载
- 添加备用加载策略（如本地fallback）
- 优化加载顺序，确保Supabase在需要前已就绪

### 实施步骤
1. **优先级1**：修复Supabase查询条件，确保能获取到题目数据
2. **优先级2**：添加网络请求超时和错误处理机制
3. **优先级3**：优化日历加载性能，实现懒加载
4. **优先级4**：增强错误诊断信息，便于问题排查
5. **优先级5**：添加优雅降级机制，确保基本功能可用

### 预期效果
- ✅ 日历加载速度显著提升
- ✅ 题目数据正常显示，不再出现"获取题目异常"
- ✅ 网络不稳定时仍能正常使用
- ✅ 错误信息更清晰，便于问题诊断
- ✅ 生产环境用户体验大幅改善

**核心修复**：主要问题很可能是数据库字段不匹配导致的查询失败，通过放宽查询条件和改进错误处理即可解决。